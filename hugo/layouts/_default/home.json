{{ $all := where .Site.RegularPages "Section" "posts" }}
{{ $published := (where $all "Params.published" "!=" false) | first 4 }}
{
  "type": "{{ .Type }}",
  "term": "{{ .Title }}",
  "pages": [
    {{ range $index, $page := $published }}
    {
      "title": "{{ $page.Title }}",
      {{ if eq $index 0 }}
      "summary": {{ $page.Summary | replaceRE `(?m)(?s:<(style|script).*(style|script)>)` `` | plainify | jsonify }},
      {{ end }}
      "subtitle": "{{ $page.Params.subtitle }}",
      "slug": "{{ replace $page.RelPermalink `index.jsonx` `` }}",
      "cover": "{{ $page.Params.cover }}",
      "category": "{{ $page.Params.category }}",
      "date": "{{ $page.Date.Format `2006-01-02T15:04:05+0800` }}"
    }{{ if lt $index (sub (len $published) 1) }},{{ end }}
    {{ end }}
  ]
}
